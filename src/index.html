<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="./css/fonts/iconfont.css">
    <link rel="stylesheet" href="./css/swiper.css">
    <!-- <link rel="stylesheet" href="./css/style.css"> -->
    <link rel="stylesheet" href="./scss/style.css">
</head>

<body>
    <div class="wrapper">
        <div class="box">
            <p class="down">下拉刷新……</p>
            <div class="header">
                <header>
                    <span>北京  <i class="iconfont icon-xiangxia"></i></span>
                    <div class="search">
                        <i class="iconfont icon-fangdajing"></i>
                        <input type="text" placeholder="输入商家/品类/商铺">
                    </div>
                    <dl>
                        <dt><i class="iconfont icon-wode"></i></dt>
                        <dd>我的</dd>
                    </dl>
                </header>
            </div>
            <div class="swiper-container container">
                <div class="swiper-wrapper">
                    <div class="swiper-slide slide1">
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                    </div>
                    <div class="swiper-slide slide2">
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                        <dl>
                            <dt><img src="./images/ico.png" alt=""></dt>
                            <dd>美食</dd>
                        </dl>
                    </div>
                </div>
                <div class="swiper-pagination pagination"></div>
            </div>
            <section class="none sec">
                <div class="guss-like">
                    <p>猜你喜欢</p>
                    <div class="list">
                        <!-- <dl>
                        <dt><img src="./images/1.jpg" alt=""></dt>
                        <dd>
                            <p>醉面一碗香的牛肉卖面</p>
                            <p>[7店通用]单人套餐</p>
                            <p><span><b>17.5元&nbsp;&nbsp;</b>门市价20元</span><span>已售21354</span></p>
                        </dd>
                    </dl>
                    <dl>
                        <dt><img src="./images/1.jpg" alt=""></dt>
                        <dd>
                            <p>醉面一碗香的牛肉卖面</p>
                            <p>[7店通用]单人套餐</p>
                            <p><span><b>17.5元&nbsp;&nbsp;</b>门市价20元</span><span>已售21354</span></p>
                        </dd>
                    </dl>
                    <dl>
                        <dt><img src="./images/1.jpg" alt=""></dt>
                        <dd>
                            <p>醉面一碗香的牛肉卖面</p>
                            <p>[7店通用]单人套餐</p>
                            <p><span><b>17.5元&nbsp;&nbsp;</b>门市价20元</span><span>已售21354</span></p>
                        </dd>
                    </dl>
                    <dl>
                        <dt><img src="./images/1.jpg" alt=""></dt>
                        <dd>
                            <p>醉面一碗香的牛肉卖面</p>
                            <p>[7店通用]单人套餐</p>
                            <p><span><b>17.5元&nbsp;&nbsp;</b>门市价20元</span><span>已售21354</span></p>
                        </dd>
                    </dl>
                    <dl>
                        <dt><img src="./images/1.jpg" alt=""></dt>
                        <dd>
                            <p>醉面一碗香的牛肉卖面</p>
                            <p>[7店通用]单人套餐</p>
                            <p><span><b>17.5元&nbsp;&nbsp;</b>门市价20元</span><span>已售21354</span></p>
                        </dd>
                    </dl>
                    <dl>
                        <dt><img src="./images/1.jpg" alt=""></dt>
                        <dd>
                            <p>醉面一碗香的牛肉卖面</p>
                            <p>[7店通用]单人套餐</p>
                            <p><span><b>17.5元&nbsp;&nbsp;</b>门市价20元</span><span>已售21354</span></p>
                        </dd>
                    </dl>
                    <dl>
                        <dt><img src="./images/1.jpg" alt=""></dt>
                        <dd>
                            <p>醉面一碗香的牛肉卖面</p>
                            <p>[7店通用]单人套餐</p>
                            <p><span><b>17.5元&nbsp;&nbsp;</b>门市价20元</span><span>已售21354</span></p>
                        </dd>
                    </dl> -->
                    </div>
                </div>
            </section>
            <p class="look"><span>查看全部团购</span><i class="iconfont icon-angle-right"></i></p>
            <footer class="none">
                <div class="login">
                    <p><span>登录</span>&nbsp;&nbsp;&nbsp;<span>注册</span></p>
                    <p>城市:&nbsp;&nbsp;<span>北京</span></p>
                </div>
                <p><a href="#">首页</a>|<a href="#">我的</a>|<a href="#">美团下载</a>|<a href="#">电脑版</a>|<a href="#">帮助</a></p>
                <h2>---------&nbsp;&nbsp;2018 美团网 京IPC证7079号&nbsp;&nbsp;---------</h2>
            </footer>
            <p class="up">上拉加载……</p>
        </div>
    </div>
    <script src="./libs/flexible.js"></script>
    <script src="./libs/better-scroll.js"></script>
    <script src="./libs/swiper.js"></script>
    <script src="./libs/jquery.min.js"></script>
    <script src="./libs/zepto.js"></script>
    <script>
        var mySwiper = new Swiper('.container', {
            pagination: {
                el: ".pagination",
                clickable: true
            }
        })
        var myBScroll = new BScroll('.wrapper', {
            probeType: 2,
            click: true,
        })
        var idx = 0;
        $.ajax({
            url: '/api/getData?idx=' + idx,
            success: function(res) {
                res = JSON.parse(res);
                if (res.code === 0) {
                    render(res.data);
                } else {
                    alert('请求失败!');
                }
            }
        })

        function render(data) {
            var str = '';
            data.map(function(item) {
                str += `
                <dl>
                    <dt><img src="./images/${item.img}" alt=""></dt>
                    <dd>
                        <p>${item.tit}</p>
                        <p>${item.menu}</p>
                         <p><span><b>${item.money}&nbsp;&nbsp;</b>门市价${item.price}元</span><span>已售${item.sell}</span></p>
                    </dd>
                </dl>
                `;
            })
            $('.list').append(str);
            myBScroll.refresh();
        }

        function render2(data) {
            var str = '';
            data.map(function(item) {
                str += `
                <dl>
                    <dt><img src="./images/${item.img}" alt=""></dt>
                    <dd>
                        <p>${item.tit}</p>
                        <p>${item.menu}</p>
                         <p><span><b>${item.money}&nbsp;&nbsp;</b>门市价${item.price}元</span><span>已售${item.sell}</span></p>
                    </dd>
                </dl>
                `;
            })
            $('.list').html(str);
            myBScroll.refresh();
        }
        $('.sec').fadeIn(1500);
        //上拉加载
        myBScroll.on("scroll", function() {
            if (this.y < this.maxScrollY - 140) {
                $(".up").html("释放加载").addClass("flip");
            } else if (this.y < 0 && this.y > this.maxScrollY - 100) {
                $(".up").html("上拉加载……").removeClass("flip");
            } else if (this.y > 70) {
                $(".down").html("释放刷新").addClass("flip");
            } else if (this.y > 0 && this.y < 10) {
                $(".down").html("下拉刷新……").removeClass("flip");
            }
        });
        myBScroll.on("scrollEnd", function() {
            if ($(".up").hasClass("flip")) {
                up();
                $(".up").html("上拉加载……").removeClass("flip");
            } else if ($(".down").hasClass("flip")) {
                down();
                $(".down").html("下拉刷新……").removeClass("flip");
            }
        });

        function up() {
            idx++;
            $.ajax({
                url: '/api/getData?idx=' + idx,
                success: function(res) {
                    res = JSON.parse(res);
                    if (res.code === 0) {
                        if (res.data.length <= 0) {
                            $('footer').removeClass('none');
                            $('.up').addClass('none');
                        } else {
                            $('footer').addClass('none');
                            $('.up').removeClass('none');
                        }
                        render(res.data);
                    } else {
                        alert('请求失败!');
                    }
                }
            })
        }

        function down() {
            idx = 0;
            $('footer').addClass('none');
            $('.up').removeClass('none');
            $.ajax({
                url: '/api/getData?idx=' + idx,
                success: function(res) {
                    res = JSON.parse(res);
                    if (res.code === 0) {
                        render2(res.data);
                    } else {
                        alert('请求失败!');
                    }
                }
            })
        }
    </script>
</body>

</html>